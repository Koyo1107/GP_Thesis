%　ここはもともとパラメーターのための予備実験を書くところだった
% どうするかはあなたに一任するわ
\chapter{予備実験}
ここでは,本研究が実験を行うにあたってその準備実験の試行として行なった実験について述べる.
%\subsection{データセット}
%この研究ではドライブレコーダーから得られる映像を用いて実験を行う.
%その際,データーセットとしてYouTube等の動画投稿サイトに投稿されたドライブレコーダーの動画を用いる.
\section{予備実験1 - 深度推定システム}
\subsection{実験内容}
本研究ではドライブレコーダーから得られる動画を用いて実験,評価を行うが,その予備実験として動画から切り出された画像を用いて本研究のシステムの実験を行った.
この予備実験は,本研究を行うにあたって,距離推定プログラムあるいは深度推定プログラムの候補が２つあり,どちらが相応しいかを決める実験である.
一つ目はFCRN-DepthPrediction\cite{laina2016deeper}というシステムであり,もう一つはstruct2depthである.
結果を\figref{fig:preex}と\figref{fig:preex2}に示す.
\figref{fig:preex}のように,このシステムは画像を上下二段に切り分け,上段では入力された映像の高さを半分にした画像,下段はその画像を用いて奥行き推定を行ったものである.
また,上段で自動車とトラックを検出し,下段の同じ位置にBBOXを出力している.
下段のBBOX内に出力されているパラメーターは,下段BOX内のRGB値のそれぞれの値を平均した数値である.

\subsection{評価}
ここでは,本研究における予備実験の評価について述べる.
\figref{fig:preex1}と\figref{fig:preex2}を比較すると,前者は深度推定を行なった結果のみを出力するのに対し,後者は元の画像を圧縮し上下二段二分けて出力されていることがわかる.
また,前者は奥にある物体が明るく色分けされているが,カメラから近いところにある道路やトラックなど,ほぼ暗い青色で塗り分けられているだけであり,物体の識別が難しい.
それに対して後者はカメラから近い距離にある物体ほど明るく塗り分けられており,奥にある物体ほど暗い色になっている.
前者と後者を比較した際,特に違いが顕著なのは後者のシステムの方が画面左側にあるトラックをはっきりと色分けできているという点である.
滋養の実験を踏まえて,本研究においては後者のGoogle Tensorflowを採用し,本実験を行うことにする.

また,\figref{fig:preex2}を見ればわかる通り,物体検出システムと距離推定システムを用いることで先行車との大まかな車間距離を調べることが可能なことがわかる.
\figref{fig:preex2}においてシステムが検出した自動車をそれぞれ右から車１,車２とおくと,下段のRGB値のそれぞれの平均を見てみると,奥にある車１の方が手前にある車２よりもR,Gの値が低く,Bの値が高いことがわかる.
%距離推定システムは奥行きを手前にある物体ほど色を明るく,奥にある（カメラから距離が遠い）物体ほど暗い青色で色分けするので,このシステムで先行車の位置関係が大まかにわかることが確認できる.
この数値の違いを評価することで先行車との距離を推定し,走行スピードを推定し,渋滞しているかどうかを機械に判断させる.


\begin{figure}[htbp]
  \begin{center}
   \includegraphics[width=12cm]{figs/preex1.png}
  \end{center}
  \caption{FCRN-DepthPredictionを用いた予備実験}
  \label{fig:preex1}

 \begin{center}
  \includegraphics[width=12cm]{figs/preex2.png}
 \end{center}
  \caption{Google Tensorflowを用いた予備実験}
  \label{fig:preex2}
\end{figure}

\newpage
% 動画への適用 ---------------------------------
% 画像処理の話
\section{予備実験2 - 動画への適用}
ここでは2つめに行った予備実験について述べる.
\subsection{実験内容}
この予備実験は,予備実験１にて行ったシステムを動画へ適用する際に行った実験である.
予備実験1では使用した二つのライブラリ（物体検出ライブラリと深度推定ライブラリ）はどちらも画像のデーターを中間ファイルを通して処理していた.
しかし,動画を使った画像処理をこなうためには,中間ファイルを経由しての処理は余分な処理を増やしてしまい,処理量と処理時間がかかってしまう問題がある.
そのため,今後は中間ファイルを経由することなくデータをやり取りするように実行した.
その際に,深度推定ライブラリ(struct2depth)に合わせて画像サイズを416 * 128の半分である 218 * 64サイズに圧縮して処理するよう実装した.
しかし,画像サイズが圧縮されたため,物体検出ライブラリでの誤検出や検出できないといった症例が起きた.

\subsection{症例}
画像を圧縮してから検出を行った際に起きたミスとしては２つあり,それぞれ誤検出と検出できないという症例である.
その検出結果を\figref{fig:miss1}と\figref{fig:miss2}に示す.
考えられる原因は元の画像を小さく圧縮したのに加え,縦横比を圧縮してしまったためである.


% --------------------------------------------------
\newpage
\begin{figure}[htbp]
  \begin{center}
   \includegraphics[width=12cm]{figs/miss_1.png}
  \end{center}
  \caption{症例1 - 誤った検出}
  \label{fig:miss1}
\end{figure}

\begin{figure}[hbtp]
 \begin{center}
  \includegraphics[width=12cm]{figs/miss_2.png}
 \end{center}
  \caption{症例2 - 自動車を検出できなかった症例}
  \label{fig:miss2}
\end{figure}

\newpage
% ---------------------------------------------------

\subsection{症例の解決}
物体検出ライブラリの誤検出を防ぐために,以下のような対策を行った.
まず,物体検出ライブラリへの影響を少なくするために,画像の圧縮を減らした.（まだやってないっす）


\newpage

\section{予備実験3 - 評価方法の決定}
ここでは3つめに行った予備実験について述べる.
\subsection{実験内容}
この予備実験は,本研究における渋滞の評価の基準を決める実験である.
本研究にて使用する深度推定システム(struct2depth)\cite{casser2019struct2depth}は奥行きを推定するシステムだが,\figref{fig:preex2}の通り,結果は色情報でしかわからず,具体的にカメラからどれだけの距離があるのかが不明である.
そのためこの予備実験２では渋滞評価のために出力された色データーから渋滞の基準を決める実験を行う.

\subsection{使用するデーター}
ここでは予備実験２にて扱うデーターについて述べる.

\subsection{結果}
ここでは予備実験２における結果について述べる.

\subsection{評価}
ここでは予備実験２の実験結果をもとに評価を行う

\section{まとめ}
本章では,本研究において実装したシステムに関して行なった予備実験について述べた.
次章では本研究における本実験について述べる.